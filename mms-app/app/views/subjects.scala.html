@(currentPage: Page[Tuple3[org.code_factory.jpa.nestedset.Node[SecuritySubject], SecuritySubject, Boolean]],
  currentSortBy: String, currentOrder: String, currentFilter: String)

@import tags._
@import utils.PaginationHelper.{link => _link, header => _header}

@link(newPageIndex: Int, newSortBy: String) = @{
  _link(currentSortBy, currentOrder, currentFilter, newPageIndex, newSortBy)
}

@header(key: String, title: String) = @{
  Html(_header(currentSortBy, currentOrder, currentFilter, key, title))
}

@main("Security Subjects", null, null) {
    @if(flash.contains("success")) {
        <div class="alert alert-success">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <div>@flash.get("success")</div>
        </div>
    }
    @if(flash.contains("error")) {
        <div class="alert alert-error">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <div>@flash.get("error")</div>
        </div>
    }
    <h1>User Hierarchy</h1>
    <div class="clearfix" style="margin-bottom: 10px;">
        <a href="@routes.Users.create" class="btn btn-small btn-success">
            <i class="icon-plus icon-white"></i>
            <span>New user&hellip;</span>
        </a>
        <a href="@routes.SecurityGroups.create" class="btn btn-small btn-success">
            <i class="icon-plus icon-white"></i>
            <span>New security group&hellip;</span>
        </a>
    </div>
    @if(currentPage.isEmpty) {
        <p>None defined.</p>
    } else {
        @helper.form(action = routes.SecuritySubjects.delete) {
            <table class="table table-hover">
                <thead>
                <tr>
                    @header("name", "Name")
                    <th colspan="2" style="width: 91px;"></th>
                </tr>
                </thead>
                <tbody>
                @for((node, subject, open) <- currentPage.getList) {
                    <tr>
                        <td>
                            @if(node.hasChildren()) {
                            <a href="@routes.SecuritySubjects.updateTreeDisplay(subject.getId(), !open, currentPage.getPageIndex, currentSortBy, currentOrder, currentFilter)" class="level@subject.getLevel()"><span class="tree-toggle">@if(open) {&#x25bc;} else {&#x25ba;}</span></a>
                            <a href="#">
                                @if(subject.isInstanceOf[User]) {
                                <i class="icon-man"></i>@subject.getName()
                                } else {
                                <i class="icon-group"></i>@subject.getName()
                                }
                            </a>
                            } else {
                            <a href="#" class="level@subject.getLevel() leaf">
                                @if(subject.isInstanceOf[User]) {
                                <i class="icon-man"></i>@subject.getName()
                                } else {
                                <i class="icon-group"></i>@subject.getName()
                                }
                            </a>
                            }
                        </td>
                        @if(subject.isInstanceOf[User]) {
                        <td style="width: 14px;"><a href="@routes.Users.edit(subject.getId())"><i class="icon-edit"></i></a></td>
                        } else {
                        <td style="width: 14px;"><a href="@routes.SecurityGroups.edit(subject.getId())"><i class="icon-edit"></i></a></td>
                        }
                        <td style="width: 77px;"><input name="deletions[]" value="@subject.getId()" type="checkbox"></td>
                    </tr>
                }
                </tbody>
                <tfoot>
                <tr>
                    <td colspan="2">
                        @paginator(currentPage, currentSortBy, currentOrder, currentFilter)
                    </td>
                    <td style="width: 77px;">
                        <button type="submit" id="btnDelete" class="btn btn-small btn-danger">
                            <i class="icon-remove icon-white"></i>
                            <span>Delete</span>
                        </button>
                    </td>
                </tr>
                </tfoot>
            </table>
        }
    }
}
